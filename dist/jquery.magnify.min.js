!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?t(require("jquery")):t(jQuery)}(function(t){"use strict";var i=t(window),e=t(document),a={draggable:!0,resizable:!0,movable:!0,keyboard:!0,title:!0,modalWidth:320,modalHeight:320,fixedContent:!0,fixedModalSize:!1,initMaximized:!1,gapThreshold:.02,ratioThreshold:.1,minRatio:.1,maxRatio:16,headToolbar:["maximize","close"],footToolbar:["zoomIn","zoomOut","prev","fullscreen","next","actualSize","rotateRight"],icons:{maximize:"fa fa-window-maximize",close:"fa fa-close",zoomIn:"fa fa-search-plus",zoomOut:"fa fa-search-minus",prev:"fa fa-arrow-left",next:"fa fa-arrow-right",fullscreen:"fa fa-photo",actualSize:"fa fa-arrows-alt",rotateLeft:"fa fa-rotate-left",rotateRight:"fa fa-rotate-right",loading:"fa fa-spinner fa-pulse"},i18n:{maximize:"maximize",close:"close",zoomIn:"zoom-in",zoomOut:"zoom-out",prev:"prev",next:"next",fullscreen:"fullscreen",actualSize:"actual-size",rotateLeft:"rotate-left",rotateRight:"rotate-right"}},o=null,n=!1,s=!1,h=function(i,e){this.options=t.extend(!0,{},a,e),e&&t.isArray(e.footToolbar)&&(this.options.footToolbar=e.footToolbar),e&&t.isArray(e.headToolbar)&&(this.options.headToolbar=e.headToolbar),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.imageData={},this.modalData={width:null,height:null,left:null,top:null},this.init(i,this.options)};h.prototype={init:function(i,a){this.open();var n=this.getImgSrc(i);this.groupName=null;var s=t(i).attr("data-group"),h=e.find('[data-group="'+s+'"]');void 0!==s?(this.groupName=s,this.getImgGroup(h,n)):this.getImgGroup(o.not("[data-group]"),n),this.loadImg(n)},creatBtns:function(i,e){var a="";return t.each(i,function(t,i){a+=e[i]}),a},creatDOM:function(){var t={maximize:'<button class="magnify-button magnify-button-maximize" title="'+this.options.i18n.maximize+'">                            <i class="'+this.options.icons.maximize+'" aria-hidden="true"></i>                        </button>',close:'<button class="magnify-button magnify-button-close" title="'+this.options.i18n.close+'">                            <i class="'+this.options.icons.close+'" aria-hidden="true"></i>                        </button>',zoomIn:'<button class="magnify-button magnify-button-zoom-in" title="'+this.options.i18n.zoomIn+'">                            <i class="'+this.options.icons.zoomIn+'" aria-hidden="true"></i>                        </button>',zoomOut:'<button class="magnify-button magnify-button-zoom-out" title="'+this.options.i18n.zoomOut+'">                            <i class="'+this.options.icons.zoomOut+'" aria-hidden="true"></i>                        </button>',prev:'<button class="magnify-button magnify-button-prev" title="'+this.options.i18n.prev+'">                            <i class="'+this.options.icons.prev+'" aria-hidden="true"></i>                        </button>',next:'<button class="magnify-button magnify-button-next" title="'+this.options.i18n.next+'">                            <i class="'+this.options.icons.next+'" aria-hidden="true"></i>                        </button>',fullscreen:'<button class="magnify-button magnify-button-fullscreen" title="'+this.options.i18n.fullscreen+'">                            <i class="'+this.options.icons.fullscreen+'" aria-hidden="true"></i>                        </button>',actualSize:'<button class="magnify-button magnify-button-actual-size" title="'+this.options.i18n.actualSize+'">                            <i class="'+this.options.icons.actualSize+'" aria-hidden="true"></i>                        </button>',rotateLeft:'<button class="magnify-button magnify-button-rotate-left" title="'+this.options.i18n.rotateLeft+'">                            <i class="'+this.options.icons.rotateLeft+'" aria-hidden="true"></i>                        </button>',rotateRight:'<button class="magnify-button magnify-button-rotate-right" title="'+this.options.i18n.rotateRight+'">                            <i class="'+this.options.icons.rotateRight+'" aria-hidden="true"></i>                        </button>'};return'<div class="magnify-modal">                                <div class="magnify-header">                                    <div class="magnify-title"></div>                                    <div class="magnify-toolbar">'+this.creatBtns(this.options.headToolbar,t)+'</div>                                </div>                                <div class="magnify-stage">                                    <img class="magnify-image" id="magnify-image" src="" alt="" title="" />                                </div>                                <div class="magnify-footer">                                    <div class="magnify-toolbar">'+this.creatBtns(this.options.footToolbar,t)+"</div>                                </div>                            </div>"},open:function(){if(!t(".magnify-modal").length&&this.options.fixedContent&&(t("html").css({overflow:"hidden"}),document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight))){var i=function(){var t=document.createElement("div");t.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(t);var i=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),i}();i&&t("html").css({"margin-right":i})}this.isOpened=!0,this.build()},build:function(){var i=this.creatDOM(),e=t(i);this.$magnify=e,this.$magnify.find(".magnify-image").rotate({angle:0}),this.$header=e.find(".magnify-header"),this.$stage=e.find(".magnify-stage"),this.$title=e.find(".magnify-title"),this.$image=e.find(".magnify-image"),this.$close=e.find(".magnify-button-close"),this.$maximize=e.find(".magnify-button-maximize"),this.$zoomIn=e.find(".magnify-button-zoom-in"),this.$zoomOut=e.find(".magnify-button-zoom-out"),this.$actualSize=e.find(".magnify-button-actual-size"),this.$fullscreen=e.find(".magnify-button-fullscreen"),this.$rotateLeft=e.find(".magnify-button-rotate-left"),this.$rotateRight=e.find(".magnify-button-rotate-right"),this.$prev=e.find(".magnify-button-prev"),this.$next=e.find(".magnify-button-next"),t("body").append(e),this.setModalPos(e),this.options.draggable&&this.draggable(this.$magnify,this.$magnify,".magnify-button"),this.options.movable&&this.movable(this.$image,this.$stage),this.options.resizable&&this.resizable(this.$magnify,this.$stage,this.$image,this.options.modalWidth,this.options.modalHeight)},close:function(a){this.$magnify.remove(),this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.isOpened=!1,!t(".magnify-modal").length&&this.options.fixedContent&&t("html").css({overflow:"","margin-right":""}),t(".magnify-modal").length||(i.off("resize"),e.off("mousemove mouseup"))},setModalPos:function(t){var a=i.width(),o=i.height(),n=e.scrollLeft(),s=e.scrollTop(),h=t.width(),l=t.height();t.css({left:(a-h)/2+n+"px",top:(o-l)/2+s+"px"})},setModalSize:function(t){var a=i.width(),o=i.height(),n=e.scrollLeft(),s=e.scrollTop(),h={left:this.$stage.css("left"),right:this.$stage.css("right"),top:this.$stage.css("top"),bottom:this.$stage.css("bottom"),borderLeft:this.$stage.css("border-left-width"),borderRight:this.$stage.css("border-right-width"),borderTop:this.$stage.css("border-top-width"),borderBottom:this.$stage.css("border-bottom-width")},g=t.width+l(h.left)+l(h.right)+l(h.borderLeft)+l(h.borderRight),r=t.height+l(h.top)+l(h.bottom)+l(h.borderTop)+l(h.borderBottom),f=(this.options.gapThreshold>0?this.options.gapThreshold:0)+1,m=Math.min(a/(g*f),o/(r*f),1),d=Math.max(g*m,this.options.modalWidth),c=Math.max(r*m,this.options.modalHeight);d=this.options.fixedModalSize?this.options.modalWidth:Math.ceil(d),c=this.options.fixedModalSize?this.options.modalHeight:Math.ceil(c),this.$magnify.css({width:d+"px",height:c+"px",left:(a-d)/2+n+"px",top:(o-c)/2+s+"px"}),this.setImageSize(t)},setImageSize:function(i){var e=this.$stage.width(),a=this.$stage.height(),o=1;o=this.isRotated?Math.min(e/i.height,a/i.width,1):Math.min(e/i.width,a/i.height,1),t(".magnify-image").css({width:Math.floor(i.width*o)+"px",height:Math.floor(i.height*o)+"px",left:(e-i.width*o)/2+"px",top:(a-i.height*o)/2+"px"}).find("group").css({width:Math.floor(i.width*o)+"px",height:Math.floor(i.height*o)+"px"}),t.extend(this.imageData,{width:i.width*o,height:i.height*o,left:(e-i.width*o)/2,top:(a-i.height*o)/2}),g({w:this.$image.width(),h:this.$image.height()},{w:this.$stage.width(),h:this.$stage.height()},this.$stage,this.isRotated)},loadImg:function(t){var i,a,o,n,s=this,h='<div class="magnify-loading"><i class="'+this.options.icons.loading+'"></i></div>';this.$magnify.append(h),this.options.initMaximized&&(this.$magnify.addClass("magnify-maximize"),this.$magnify.css({width:"100%",height:"100%",left:e.scrollLeft(),top:e.scrollTop()}),this.isMaximized=!0),this.$image.attr("src",t),i=t,a=function(t){s.imageData={originalWidth:t.width,originalHeight:t.height},s.isMaximized?s.setImageSize(t):s.setModalSize(t),s.$magnify.find(".magnify-loading").remove(),s.addEvent()},o=function(){s.$magnify.find(".magnify-loading").remove(),s.addEvent()},(n=new Image).onload=function(){a(n)},n.onerror=function(){o(n)},n.src=i,this.options.title&&this.setImgTitle(t)},getImgGroup:function(i,e){var a=this;a.groupData=[],t(i).each(function(i,o){var n=a.getImgSrc(this);a.groupData.push({src:n,caption:t(this).attr("data-caption")}),e===n&&(a.groupIndex=i)})},setImgTitle:function(t){var i=this.groupIndex,e=(e=this.groupData[i].caption)||t.replace(/^.*?\/*([^/?]*)\.[a-z]+(\?.+|$)/gi,"$1");this.$title.text(e)},getImgSrc:function(i){return t(i).attr("data-src")?t(i).attr("data-src"):t(i).attr("href")},jump:function(t){this.groupIndex=this.groupIndex+t,this.jumpTo(this.groupIndex)},jumpTo:function(t){(t%=this.groupData.length)>=0?t%=this.groupData.length:t<0&&(t=(this.groupData.length+t)%this.groupData.length),this.groupIndex=t,this.loadImg(this.groupData[t].src)},wheel:function(t){t.preventDefault();var i=1;t.originalEvent.deltaY?i=t.originalEvent.deltaY>0?1:-1:t.originalEvent.wheelDelta?i=-t.originalEvent.wheelDelta/120:t.originalEvent.detail&&(i=t.originalEvent.detail>0?1:-1);var a=-i*this.options.ratioThreshold,o={x:t.originalEvent.clientX-this.$stage.offset().left+e.scrollLeft(),y:t.originalEvent.clientY-this.$stage.offset().top+e.scrollTop()};this.zoom(a,o,t)},zoom:function(i,e,a){(i=i<0?1/(1-i):1+i)>.95&&i<1.05&&(i=1),i=t(".magnify-image").width()/this.imageData.originalWidth*i,i=Math.max(i,this.options.minRatio),i=Math.min(i,this.options.maxRatio),this.zoomTo(i,e,a)},zoomTo:function(i,e,a){var o=t(".magnify-image"),n=t(".magnify-stage"),s=this.imageData.width,h=this.imageData.height,l=this.imageData.left,r=this.imageData.top,f={w:n.width(),h:n.height(),x:n.offset().left,y:n.offset().top},m=this.imageData.originalWidth*i,d=this.imageData.originalHeight*i,c=e.x-(e.x-l)/s*m,p=e.y-(e.y-r)/h*d,u=(this.isRotated,this.isRotated?d:m),x=this.isRotated?m:d;
// The conditions with image rotate 90 degree drive me crazy alomst!
o.css({width:Math.ceil(m)+"px",height:Math.ceil(d)+"px",left:c+"px",top:p+"px"}).find("group").css({width:Math.ceil(m)+"px",height:Math.ceil(d)+"px"}),t.extend(this.imageData,{width:m,height:d,left:c,top:p}),g({w:u,h:x},{w:f.w,h:f.h},this.$stage)},rotate:function(t){this.rotateAngle=this.rotateAngle+t,this.rotateAngle/90%2==0?this.isRotated=!1:this.isRotated=!0,this.rotateTo(this.rotateAngle)},rotateTo:function(t){this.$magnify.find(".magnify-image").rotate({angle:t}),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight}),this.$stage.removeClass("is-grab")},resize:function(){var t,i,e,a=this;return t=function(){a.isOpened&&(a.isMaximized||a.setModalSize({width:a.imageData.originalWidth,height:a.imageData.originalHeight}),a.setImageSize({width:a.imageData.originalWidth,height:a.imageData.originalHeight}))},i=500,e=null,function(){var a=this,o=arguments;clearTimeout(e),e=setTimeout(function(){t.apply(a,o)},i)}},maximize:function(){this.isMaximized?(this.$magnify.removeClass("magnify-maximize"),this.$magnify.css({width:this.modalData.width?this.modalData.width:this.options.modalWidth,height:this.modalData.height?this.modalData.height:this.options.modalHeight,left:this.modalData.left?this.modalData.left:(i.width()-this.options.modalWidth)/2+e.scrollLeft(),top:this.modalData.top?this.modalData.top:(i.height()-this.options.modalHeight)/2+e.scrollTop()}),this.isMaximized=!1):(this.modalData={width:this.$magnify.width(),height:this.$magnify.height(),left:this.$magnify.offset().left,top:this.$magnify.offset().top},this.$magnify.addClass("magnify-maximize"),this.$magnify.css({width:"100%",height:"100%",left:e.scrollLeft(),top:e.scrollTop()}),this.isMaximized=!0),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight})},fullscreen:function(){var t;(t=this.$magnify[0]).requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},keydown:function(t){var i=this;if(!this.options.keyboard)return!1;var e=t.keyCode||t.which||t.charCode,a=t.ctrlKey||t.metaKey,o=t.altKey||t.metaKey;switch(e){case 37:i.jump(-1);break;case 39:i.jump(1);break;case 187:i.zoom(3*i.options.ratioThreshold,{x:i.$stage.width()/2,y:i.$stage.height()/2},t);break;case 189:i.zoom(3*-i.options.ratioThreshold,{x:i.$stage.width()/2,y:i.$stage.height()/2},t);break;case 61:i.zoom(3*i.options.ratioThreshold,{x:i.$stage.width()/2,y:i.$stage.height()/2},t);break;case 173:i.zoom(3*-i.options.ratioThreshold,{x:i.$stage.width()/2,y:i.$stage.height()/2},t);break;case 48:a&&o&&i.zoomTo(1,{x:i.$stage.width()/2,y:i.$stage.height()/2},t);break;case 188:a&&i.rotate(-90);break;case 190:a&&i.rotate(90)}},addEvent:function(){var t=this;this.$close.off("click").on("click",function(i){t.close()}),e.off("wheel mousewheel DOMMouseScroll",".magnify-image").on("wheel mousewheel DOMMouseScroll",".magnify-image",function(i){t.wheel(i)}),this.$zoomIn.off("click").on("click",function(i){t.zoom(3*t.options.ratioThreshold,{x:t.$stage.width()/2,y:t.$stage.height()/2},i)}),this.$zoomOut.off("click").on("click",function(i){t.zoom(3*-t.options.ratioThreshold,{x:t.$stage.width()/2,y:t.$stage.height()/2},i)}),this.$actualSize.off("click").on("click",function(i){t.zoomTo(1,{x:t.$stage.width()/2,y:t.$stage.height()/2},i)}),this.$prev.off("click").on("click",function(){t.jump(-1)}),this.$fullscreen.off("click").on("click",function(){t.fullscreen()}),this.$next.off("click").on("click",function(){t.jump(1)}),this.$rotateLeft.off("click").on("click",function(){t.rotate(-90)}),this.$rotateRight.off("click").on("click",function(){t.rotate(90)}),this.$maximize.off("click").on("click",function(){t.maximize()}),e.off("keydown").on("keydown",function(i){t.keydown(i)}),i.on("resize",t.resize())}},t.magnify={instance:h.prototype},t.fn.magnify=function(i){return o=t(this),"string"==typeof i||o.off("click.magnify").on("click.magnify",function(e){e.isDefaultPrevented()||(e.preventDefault(),t(this).data("magnify",new h(this,i)))}),o},e.on("click.magnify","[data-magnify]",function(i){o=t("[data-magnify]"),i.isDefaultPrevented()||(i.preventDefault(),t(this).data("magnify",new h(this,{})))});t.extend(h.prototype,{draggable:function(i,a,o){var h=this,l=!1,g=0,r=0,f=0,m=0;t(a).on("mousedown.magnify",function(e){if((e=e||window.event).preventDefault(),t(e.target).closest(o).length)return!0;l=!0,g=e.clientX,r=e.clientY,f=t(i).offset().left,m=t(i).offset().top}),e.on("mousemove.magnify",function(e){if((e=e||window.event).preventDefault(),l&&!n&&!s&&!h.isMaximized){var a=e.clientX,o=e.clientY,d=a-g,c=o-r;t(i).css({left:d+f+"px",top:c+m+"px"})}}),e.on("mouseup.magnify",function(t){l=!1})}});t.extend(h.prototype,{movable:function(i,a){var o=this,s=!1,h=0,l=0,g=0,r=0,f=0;e.on("mousedown.magnify",".magnify-image",function(i){(i=i||window.event).preventDefault();var e=t(".magnify-image").width(),m=t(".magnify-image").height();t(".magnify-stage").width(),t(".magnify-stage").height(),h=i.clientX,l=i.clientY,f=o.isRotated?(e-m)/2:0,
// widthDiff = !self.isRotated ? (imageWidth - stageWidth) : (imageHeight - stageWidth);
// heightDiff = !self.isRotated ? (imageHeight - stageHeight) : (imageWidth - stageHeight);
s=!0,n=!0,"Microsoft Internet Explorer"==navigator.appName&&"8."==navigator.appVersion.match(/8./i)?(g=t(".magnify-image").position().left,r=t(".magnify-image").position().top):(g=t(".magnify-image").position().left-f,r=t(".magnify-image").position().top+f),a.hasClass("is-grab")&&a.addClass("is-grabbing")}),e.on("mousemove.magnify",function(i){if((i=i||window.event).preventDefault(),s){var e=i.clientX,a=i.clientY,n=e-h+g,f=a-l+r;t(".magnify-image").css({left:n+"px",top:f+"px"}),t.extend(o.imageData,{left:n,top:f})}}),e.on("mouseup.magnify",function(t){s=!1,n=!1,a.removeClass("is-grabbing")})}});function l(t){var i=t.match(/\d+/g);return parseFloat(i[0])}function g(t,i,e,a){var o=a?t.h:t.w,n=a?t.w:t.h;(n>i.h||o>i.w)&&e.addClass("is-grab"),n<=i.h&&o<=i.w&&e.removeClass("is-grab")}t.extend(h.prototype,{resizable:function(i,a,o,n,h){var l=this,r=t('<div class="resizable-handle resizable-handle-e"></div>'),f=t('<div class="resizable-handle resizable-handle-w"></div>'),m=t('<div class="resizable-handle resizable-handle-s"></div>'),d=t('<div class="resizable-handle resizable-handle-n"></div>'),c=t('<div class="resizable-handle resizable-handle-se"></div>'),p=t('<div class="resizable-handle resizable-handle-sw"></div>'),u=t('<div class="resizable-handle resizable-handle-ne"></div>'),x=t('<div class="resizable-handle resizable-handle-nw"></div>'),y={e:r,s:m,se:c,n:d,w:f,nw:x,ne:u,sw:p};t(i).append(r,f,m,d,c,p,u,x);var w=!1,b=0,v=0,z={w:0,h:0,l:0,t:0},$={w:0,h:0,l:0,t:0},M={w:0,h:0,l:0,t:0},D=0,T=0,k=0,I="";t.each(y,function(e,o){o.on("mousedown.magnify",function(o){var n,h;n=e,(h=(h=o)||window.event).preventDefault(),w=!0,s=!0,b=h.clientX,v=h.clientY,z={w:t(i).width(),h:t(i).height(),l:t(i).offset().left,t:t(i).offset().top},$={w:t(a).width(),h:t(a).height(),l:t(a).offset().left,t:t(a).offset().top},M={w:t(".magnify-image").width(),h:t(".magnify-image").height(),l:t(".magnify-image").position().left,t:t(".magnify-image").position().top},D=l.isRotated?(M.w-M.h)/2:0,T=l.isRotated?M.h:M.w,k=l.isRotated?M.w:M.h,I=n})}),e.on("mousemove.magnify",function(e){var a,o,s,g,r,f,m,d,c,p,u,x,y,M;if((e=e||window.event).preventDefault(),w&&!l.isMaximized){var R=e.clientX,S=e.clientY,C=R-b,O=S-v,H=(p=I,x=O,y=-(u=C)+z.w>n?u+z.l:z.l+z.w-n,M=-x+z.h>h?x+z.t:z.t+z.h-h,{e:{width:Math.max(u+z.w,n)+"px"},s:{height:Math.max(x+z.h,h)+"px"},se:{width:Math.max(u+z.w,n)+"px",height:Math.max(x+z.h,h)+"px"},w:{width:Math.max(-u+z.w,n)+"px",left:y+"px"},n:{height:Math.max(-x+z.h,h)+"px",top:M+"px"},nw:{width:Math.max(-u+z.w,n)+"px",height:Math.max(-x+z.h,h)+"px",top:M+"px",left:y+"px"},ne:{width:Math.max(u+z.w,n)+"px",height:Math.max(-x+z.h,h)+"px",top:M+"px"},sw:{width:Math.max(-u+z.w,n)+"px",height:Math.max(x+z.h,h)+"px",left:y+"px"}}[p]);t(i).css(H);var L=(a=I,s=O,g=(o=C)+z.w>n?$.w-T+o-D:n-(z.w-$.w)-T-D,r=s+z.h>h?$.h-k+s+D:h-(z.h-$.h)-k+D,f=-o+z.w>n?$.w-T-o-D:n-(z.w-$.w)-T-D,m=-s+z.h>h?$.h-k-s+D:h-(z.h-$.h)-k+D,d=t(".magnify-image").position().left-D,c=t(".magnify-image").position().top+D,{e:{left:g>=-D?(g-D)/2+"px":d>g?d+"px":g+"px"},s:{top:r>=D?(r+D)/2+"px":c>r?c+"px":r+"px"},se:{top:r>=D?(r+D)/2+"px":c>r?c+"px":r+"px",left:g>=-D?(g-D)/2+"px":d>g?d+"px":g+"px"},w:{left:f>=-D?(f-D)/2+"px":d>f?d+"px":f+"px"},n:{top:m>=D?(m+D)/2+"px":c>m?c+"px":m+"px"},nw:{top:m>=D?(m+D)/2+"px":c>m?c+"px":m+"px",left:f>=-D?(f-D)/2+"px":d>f?d+"px":f+"px"},ne:{top:m>=D?(m+D)/2+"px":c>m?c+"px":m+"px",left:g>=-D?(g-D)/2+"px":d>g?d+"px":g+"px"},sw:{top:r>=D?(r+D)/2+"px":c>r?c+"px":r+"px",left:f>=-D?(f-D)/2+"px":d>f?d+"px":f+"px"}}[a]);t(".magnify-image").css(L)}}),e.on("mouseup.magnify",function(i){s&&g({w:T,h:k},{w:t(a).width(),h:t(a).height()},a),w=!1,s=!1})}})});